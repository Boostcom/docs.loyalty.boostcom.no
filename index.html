<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Boostcom Loyalty API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.svg" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://loyalty.boostcom.no'>Boostcom Loyalty</a></li>
            <li><a href='http://boostcom.com/'>Boostcom</a></li>
            <li><hr/></li>
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>It&rsquo;s an API to manage loyalty club&rsquo;s members.
It can be accessed from both Boostcom&rsquo;s internal server applications as well as from native mobile applications as well as external client&rsquo;s server applications.</p>

<h1 id="global-settings">Global settings</h1>

<h2 id="host">Host</h2>

<p>V1 &amp; V2 API host is https://connect.bstcm.no/</p>

<h2 id="content-type">Content-Type</h2>

<p>This API supports <code class="prettyprint">application/json</code> only. </p>

<p>Both payload and response body are supposed to be a valid JSON so when making a request send a <code class="prettyprint">Content-Type: application/json</code> header.</p>

<p>If payload is not a valid JSON, then <code class="prettyprint">406 Not Acceptable</code> HTTP code and empty response body are returned.</p>

<h2 id="msisdn-member-identifier">Msisdn - member identifier</h2>

<p>Members in our systems are identified with their phone numbers (msisdns) according to <a href="https://en.wikipedia.org/wiki/E.164">E.164</a>
We use format without leading <code class="prettyprint">00</code> or <code class="prettyprint">+</code> and without spaces, so that it contains only digits, i.e. <code class="prettyprint">4740485124</code>.</p>

<p>There is no special handling in case it has wrong format, except for creating a member and sending a token.
<code class="prettyprint">404 Not Found</code> is returned and empty response body unless stated otherwise.</p>

<h2 id="registration-options">Registration options</h2>

<p>New members could be created with or without password confirmation depending on which token is being used on <em>Create member</em> action.</p>

<p><em>Send token</em> action will trigger sending member token/password to provided msisdn no matter whether msisdn is already a member or not.</p>

<h1 id="validation-on-members">Validation on members</h1>

<p>All members&rsquo; endpoints have properties validation. Properties are validated to conform loyalty club&rsquo;s schema.</p>

<p>If something is wrong, you will receive explanation of errors in response.</p>

<aside class="warning">
Errors format and strings are not yet stable and may change without further notice.
</aside>

<h2 id="schema-validation-errors">Schema validation errors</h2>
<pre class="highlight shell tab-shell"><code>curl -X PUT -H <span class="s2">"X-Product-Name: custom-product-name"</span> <span class="se">\</span>
    -H <span class="s2">"X-Customer-Private-Token: token"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> -d <span class="s1">'{
    "properties": {
        "first_name": "",
        "last_name": "err",
        "gender": "man",
        "birthday": "201X-01-01"
    }
}'</span> <span class="s2">"https://tbp.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span>
</code></pre>
<blockquote>
<p>Example response (with code 400):</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_date_format"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"birthday"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"gender"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_not_match"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gender"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"man"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"values"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mann, Kvinne"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"not_contain_required_property"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"first_name"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Error</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>invalid_date_format</td>
<td>Invalid date format</td>
</tr>
<tr>
<td>invalid_time_format</td>
<td>Invalid time format</td>
</tr>
<tr>
<td>invalid_date_time_format</td>
<td>Invalid date with time format</td>
</tr>
<tr>
<td>must_be_valid_RFC3339_date_time_string</td>
<td>Format beyond the RFC3339 standard</td>
</tr>
<tr>
<td>invalid_URI</td>
<td>Invalid URI</td>
</tr>
<tr>
<td>additional_array_elements</td>
<td>Additional elements in the array</td>
</tr>
<tr>
<td>additional_properties</td>
<td>Additional properties</td>
</tr>
<tr>
<td>property_not_match_all_of</td>
<td>The property did not match all of the required schemas</td>
</tr>
<tr>
<td>property_not_match_any_of</td>
<td>The property did not match any of the required schema</td>
</tr>
<tr>
<td>property_matched_more_than_one</td>
<td>The property matched more than one of the required schemas</td>
</tr>
<tr>
<td>depends_on_a_missing_property</td>
<td>The validated property has a property that depends on the other missing property</td>
</tr>
<tr>
<td>value_not_match</td>
<td>The property value did not match one of the given values.</td>
</tr>
<tr>
<td>schema_cannot_be_found</td>
<td>The extended schema cannot be found</td>
</tr>
<tr>
<td>not_a_valid_schema</td>
<td>The property was not a valid schema</td>
</tr>
<tr>
<td>minimum_string_length</td>
<td>The property was not of a minimum string length of minimum limit.</td>
</tr>
<tr>
<td>maximum_string_length</td>
<td>The property was not of a maximum string length of maximum limit.</td>
</tr>
<tr>
<td>less_item_than_minimum</td>
<td>The property did not contain a minimum number of minimum items limit</td>
</tr>
<tr>
<td>more_item_than_maximum</td>
<td>The property had more items than the allowed items limit</td>
</tr>
<tr>
<td>less_properties_than_minimum</td>
<td>The property did not contain a minimum number of properties</td>
</tr>
<tr>
<td>more_properties_than_maximum</td>
<td>The property had more properties than allowed</td>
</tr>
<tr>
<td>not_have_value_of_exclusively</td>
<td>The property did not have value of exclusively</td>
</tr>
<tr>
<td>not_have_value_of_inclusively</td>
<td>The property did not have value of inclusively</td>
</tr>
<tr>
<td>more_decimal_places_than_maximum</td>
<td>The property had more decimal places than the allowed maximum</td>
</tr>
<tr>
<td>matched_the_disallowed_schema</td>
<td>The property matched the disallowed schema</td>
</tr>
<tr>
<td>the_regex_not_match</td>
<td>The property did not match the regex</td>
</tr>
<tr>
<td>not_contain_required_property</td>
<td>The validated property did not contain a required property</td>
</tr>
<tr>
<td>contained_undefined_properties</td>
<td>The validated property contained undefined properties</td>
</tr>
<tr>
<td>referenced_schema_cannot_be_found</td>
<td>The referenced schema cannot be found</td>
</tr>
<tr>
<td>invalid_schema</td>
<td>The property was not a valid schema</td>
</tr>
<tr>
<td>matched_one_or_more_types</td>
<td>The property matched one or more of the given types</td>
</tr>
<tr>
<td>one_or_more_types_not_match</td>
<td>The property did not match one or more of the given types</td>
</tr>
<tr>
<td>type_not_match</td>
<td>The property did not match the given type</td>
</tr>
<tr>
<td>contained_duplicated_array_values</td>
<td>The property contained duplicated array values</td>
</tr>
<tr>
<td>invalid_email</td>
<td>Invalid email format</td>
</tr>
<tr>
<td>disposable_email</td>
<td>The email was <a href="https://github.com/lisinge/valid_email2/blob/master/vendor/disposable_emails.yml">disposable</a></td>
</tr>
<tr>
<td>duplicated_email</td>
<td>The email was duplicated in community</td>
</tr>
</tbody></table>

          <h1 id="api-v2-reference">Api V2 reference</h1>

<p>You can use Api V2 fully, only when your schema is ready to support it.</p>

<h2 id="authentication">Authentication</h2>

<p>All of the endpoints require a single authentication header.</p>

<ul>
<li><code class="prettyprint">X-Member-Token</code> represents SMS pass code sent to the member and allows to manage his own profile only. To trigger that SMS use <code class="prettyprint">/send_token</code> call.</li>
<li><code class="prettyprint">X-Customer-Public-Token</code> is used for endpoints that are not sensitive (not destructive and do not leak any personal data). Currently:

<ul>
<li>Get schema</li>
<li>Send token</li>
<li>Check if member exists</li>
</ul></li>
<li><code class="prettyprint">X-Customer-Private-Token</code> can be used for batch operations on any member of the customer&rsquo;s loyalty club.
It could be used for all operations that allow authentication with <code class="prettyprint">X-Customer-Public-Token</code>.
It should be used only on backend and never exposed in frontend code.</li>
</ul>

<p>If you miss your authentication tokens, please <a href="http://boostcom.no">let us know</a>.</p>

<aside class="notice">
You must use only one header in each request.
</aside>

<h2 id="product-name">Product name</h2>

<p>Each system that is communicating with us should uniquely identify itself so it is possible to distinguish optin/update channels.
That will allow further targeting members by communication channel.
For that we use product name and header <code class="prettyprint">X-Product-Name</code> is intended to provide the necessary granularity.</p>

<p>If you miss your product name, please <a href="http://boostcom.no">let us know</a>.</p>

<aside class="warning">
Product Name header is required in each request!
<br>
When it is missing or it has incorrect value, then <code>401 Unauthorized</code> HTTP code and empty response body are returned.
</aside>

<h2 id="get-loyalty-clubs-schema">Get loyalty club&rsquo;s schema</h2>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/member_schema"</span> <span class="se">\</span>
  -H <span class="s2">"X-Customer-Public-Token: alphanumeric_string"</span> <span class="se">\</span>
  -H <span class="s2">"X-Product-Name: custom-product-name"</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://json-schema.org/draft-04/schema#"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"languages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"en"</span><span class="p">,</span><span class="w"> </span><span class="s2">"no"</span><span class="p">],</span><span class="w">
  </span><span class="s2">"default_language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"bikes_and_cars"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"sportwear"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Properties for members are defined as part of the loyalty club they belong to.
To describe member properties we use <a href="http://json-schema.org/documentation.html">JSON Schema</a> definition.
Properties of each member must conform to the defined schema.
We support <strong>JSON schema Draft V4</strong> with format extension for <code class="prettyprint">date</code> (YYYY-MM-DD).</p>

<p>Keys explanation:</p>

<ul>
<li><code class="prettyprint">languages</code> [Array of strings] - array of languages set up in loyalty club</li>
<li><code class="prettyprint">default_language</code> [string] - default language used in loyalty club and also used for mappings to Api v2</li>
<li><code class="prettyprint">version</code> [string] - version of schema, currently the newest is <code class="prettyprint">v2</code></li>
<li><code class="prettyprint">products</code> [Object] - properties scoping and ordering by product name, default one is <code class="prettyprint">default</code></li>
<li><code class="prettyprint">required</code> [Array of strings] - required properties for member</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><strong>GET</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/member_schema</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
</tbody></table>

<aside class="notice">
Authentication only with <code>X-Customer-Public-Token</code>.
</aside>

<h2 id="send-member-token">Send member token</h2>

<p><strong>Member tokens</strong> are used to authenticate actions on particular members.
<strong>Member token</strong> could be issued even before registering enduser as a member in community.
In that case we create temporary token that is valid till end of day.
That <strong>member token</strong> could be used to authenticate <em>Create Member</em> action described below.</p>

<p>It sends member token to the user via SMS.</p>

<p>It can be used multiple times.</p>

<p>If msisdn is not valid, then <code class="prettyprint">400 Bad Request</code> is returned.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>POST</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn/send_token</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<aside class="notice">
Authentication with <code>X-Customer-Public-Token</code> or <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="check-if-member-exists">Check if member exists</h2>
<pre class="highlight shell tab-shell"><code>curl -I <span class="s2">"https://connect.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span> <span class="se">\</span>
  -H <span class="s2">"X-Customer-Public-Token: alphanumeric_string"</span> <span class="se">\</span>
  -H <span class="s2">"X-Product-Name: custom-product-name"</span>
</code></pre>
<blockquote>
<p>Response will be 200 or 404 code.</p>
</blockquote>

<p>It can be used to check if member is in loyalty club or not.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>HEAD</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="response-codes">Response codes</h3>

<ul>
<li><strong>200</strong> - member exists</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Customer-Public-Token</code>.
</aside>

<h2 id="get-member">Get member</h2>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span> <span class="se">\</span>
  -H <span class="s2">"X-Customer-Private-Token: alphanumeric_string"</span> <span class="se">\</span>
  -H <span class="s2">"X-Product-Name: custom-product-name"</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ola"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nordmann"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-10-23"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"bikes_and_cars"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"sportwear"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"child_birth_years"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2010</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-19T10:07:08.336+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-03T09:35:19.313+02:00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Fetches member&rsquo;s properties.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member ID</td>
<td>integer</td>
</tr>
<tr>
<td>properties</td>
<td>Object with member&rsquo;s properties</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&lsquo;language&rsquo;]</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>created_at</td>
<td>Time when the user was firstly created</td>
<td>string</td>
</tr>
<tr>
<td>updated_at</td>
<td>Time when the user was last updated</td>
<td>string</td>
</tr>
</tbody></table>

<h3 id="http-request">HTTP Request</h3>

<p><strong>GET</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="create-member">Create member</h2>

<p>Create member with given properties.</p>

<p>When invalid authentication token is provided response <code class="prettyprint">401 Unauthorized</code> is returned disregarding whether member exists or not.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>PUT</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="put-json-parameters">PUT (JSON) Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&lsquo;language&rsquo;]</td>
<td>Language used by user, if not set then &ldquo;default_language&rdquo; is taken from schema</td>
<td>string</td>
</tr>
<tr>
<td>send_welcome_message</td>
<td>If true, SMS welcome message will be send to member</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_email_welcome_message</td>
<td>If true and emails configured in loyalty club, email welcome (verification) message will be send to member</td>
<td>Boolean</td>
</tr>
</tbody></table>

<aside class="notice">
There is possibility to have multiple SMS welcome messages. Sent will be the one that matches Product or default one.
</aside>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>400 Bad request</strong> - <code class="prettyprint">msisdn</code> is invalid or there are <a href="#validation-on-members">validation errors</a>.</li>
<li><strong>409 Conflict</strong> - member with <code class="prettyprint">msisdn</code> already exists in loyalty club</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="update-member">Update member</h2>

<p>Update member&rsquo;s properties with given ones.</p>

<p>It is intended for partial updates - not given properties are neither deleted nor overwritten.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>PATCH</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="patch-json-parameters">PATCH (JSON) Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>400 Bad request</strong> - <code class="prettyprint">msisdn</code> is invalid or there are <a href="#validation-on-members">validation errors</a>.</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="remove-member">Remove member</h2>

<p>Removes member from loyalty club.</p>

<p>It is possible to trigger optout message by setting <code class="prettyprint">send_unsubscribe_message=true</code> query string parameter.</p>

<h3 id="http-request">HTTP Request</h3>
<pre class="highlight shell tab-shell"><code>curl -X DELETE -H <span class="s2">"X-Customer-Private-Token: alphanumeric_string"</span> <span class="se">\</span>
     -H <span class="s2">"X-Product-Name: custom-product-name"</span> <span class="se">\</span>
     <span class="s2">"https://connect.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/member_schema"</span>
</code></pre>
<blockquote>
<p>Successful removal is indicated by response code 200</p>
</blockquote>

<p><strong>DELETE</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>send_unsubscribe_message</td>
<td>If true, optout message will be send to member. Example: <code class="prettyprint">true</code>.</td>
<td>Boolean</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

          <h1 id="api-v1-reference-deprecated">Api V1 reference (deprecated)</h1>

<p>Api V1 endpoints that are in Api V2 are deprecated. Please don&rsquo;t use it.</p>

<p>Main goal of Api V2 is to support internationalized member properties.</p>

<h2 id="authentication">Authentication</h2>

<p>All of the endpoints require a single authentication header.</p>

<ul>
<li><code class="prettyprint">X-Member-Token</code> represents SMS pass code sent to the member and allows to manage his own profile only. To trigger that SMS use <code class="prettyprint">/send_token</code> call.</li>
<li><code class="prettyprint">X-Customer-Public-Token</code> is used for endpoints that are not sensitive (not destructive and do not leak any personal data). Currently:

<ul>
<li>Get schema</li>
<li>Send token</li>
<li>Check if member exists</li>
</ul></li>
<li><code class="prettyprint">X-Customer-Private-Token</code> can be used for batch operations on any member of the customer&rsquo;s loyalty club.
It could be used for all operations that allow authentication with <code class="prettyprint">X-Customer-Public-Token</code>.
It should be used only on backend and never exposed in frontend code.</li>
</ul>

<p>If you miss your authentication tokens, please <a href="http://boostcom.no">let us know</a>.</p>

<aside class="notice">
You must use only one header in each request.
</aside>

<h2 id="product-name">Product name</h2>

<p>Each system that is communicating with us should uniquely identify itself so it is possible to distinguish optin/update channels.
That will allow further targeting members by communication channel.
For that we use product name and header <code class="prettyprint">X-Product-Name</code> is intended to provide the necessary granularity.</p>

<p>If you miss your product name, please <a href="http://boostcom.no">let us know</a>.</p>

<aside class="warning">
Product Name header is required in each request!
<br>
When it is missing or it has incorrect value, then <code>401 Unauthorized</code> HTTP code and empty response body are returned.
</aside>

<h2 id="get-loyalty-clubs-schema">Get loyalty club&rsquo;s schema</h2>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v1/loyalty_clubs/:loyalty_club_slug/member_schema"</span> <span class="se">\</span>
  -H <span class="s2">"X-Customer-Public-Token: alphanumeric_string"</span> <span class="se">\</span>
  -H <span class="s2">"X-Product-Name: custom-product-name"</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://json-schema.org/draft-04/schema#"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fornavn"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Etternavn"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FÃ¸dselsdato"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Interesser"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"bikes &amp; cars"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"sportwear"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Properties for members are defined as part of the loyalty club they belong to.
To describe member properties we use <a href="http://json-schema.org/documentation.html">JSON Schema</a> definition.
Properties of each member must conform to the defined schema.
We support <strong>JSON schema Draft V4</strong> with format extension for <code class="prettyprint">date</code> (YYYY-MM-DD).</p>

<p>If loyalty club&rsquo;s schema is in v2, schema will be mapped to keep old behaviour (title fields + enums).</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>GET</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/member_schema</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
</tbody></table>

<aside class="notice">
Authentication only with <code>X-Customer-Public-Token</code>.
</aside>

<h2 id="send-member-token">Send member token</h2>

<p><strong>Member tokens</strong> are used to authenticate actions on particular members.
<strong>Member token</strong> could be issued even before registering enduser as a member in community.
In that case we create temporary token that is valid till end of day.
That <strong>member token</strong> could be used to authenticate <em>Create Member</em> action described below.</p>

<p>It sends member token to the user via SMS.</p>

<p>It can be used multiple times.</p>

<p>If msisdn is not valid, then <code class="prettyprint">400 Bad Request</code> is returned.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>POST</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn/send_token</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<aside class="notice">
Authentication with <code>X-Customer-Public-Token</code> or <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="check-if-member-exists">Check if member exists</h2>
<pre class="highlight shell tab-shell"><code>curl -I <span class="s2">"https://connect.bstcm.no/api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span> <span class="se">\</span>
  -H <span class="s2">"X-Customer-Public-Token: alphanumeric_string"</span> <span class="se">\</span>
  -H <span class="s2">"X-Product-Name: custom-product-name"</span>
</code></pre>
<blockquote>
<p>Response will be 200 or 404 code.</p>
</blockquote>

<p>It can be used to check if member is in loyalty club or not.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>HEAD</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="response-codes">Response codes</h3>

<ul>
<li><strong>200</strong> - member exists</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Customer-Public-Token</code>.
</aside>

<h2 id="get-member">Get member</h2>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span> <span class="se">\</span>
  -H <span class="s2">"X-Customer-Private-Token: alphanumeric_string"</span> <span class="se">\</span>
  -H <span class="s2">"X-Product-Name: custom-product-name"</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ola"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nordmann"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-10-23"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"bikes &amp; cars"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"sportwear"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"child_birth_years"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2010</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-19T10:07:08.336+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-03T09:35:19.313+02:00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Fetches member&rsquo;s properties.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member ID</td>
<td>integer</td>
</tr>
<tr>
<td>properties</td>
<td>Object with member&rsquo;s properties</td>
<td>JSON Object</td>
</tr>
<tr>
<td>created_at</td>
<td>Time when the user was firstly created</td>
<td>string</td>
</tr>
<tr>
<td>updated_at</td>
<td>Time when the user was last updated</td>
<td>string</td>
</tr>
</tbody></table>

<p>If loyalty club&rsquo;s schema is in v2, some of properties will be mapped to keep old behaviour.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>GET</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="create-member">Create member</h2>

<p>Create member with given properties.</p>

<p>When invalid authentication token is provided response <code class="prettyprint">401 Unauthorized</code> is returned disregarding whether member exists or not.</p>

<p>If loyalty club&rsquo;s schema is in v2, some of properties will be mapped to keep old behaviour.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>PUT</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="put-json-parameters">PUT (JSON) Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
<tr>
<td>send_welcome_message</td>
<td>If true, SMS welcome message will be send to member</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_email_welcome_message</td>
<td>If true and emails configured in loyalty club, email welcome (verification) message will be send to member</td>
<td>Boolean</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>400 Bad request</strong> - <code class="prettyprint">msisdn</code> is invalid or there are <a href="#validation-on-members">validation errors</a>.</li>
<li><strong>409 Conflict</strong> - member with <code class="prettyprint">msisdn</code> already exists in loyalty club</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="update-member">Update member</h2>

<p>Update member&rsquo;s properties with given ones.</p>

<p>It is intended for partial updates - not given properties are neither deleted nor overwritten.</p>

<p>If loyalty club&rsquo;s schema is in v2, some of properties will be mapped to keep old behaviour.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>PATCH</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="patch-json-parameters">PATCH (JSON) Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>400 Bad request</strong> - <code class="prettyprint">msisdn</code> is invalid or there are <a href="#validation-on-members">validation errors</a>.</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

<h2 id="remove-member">Remove member</h2>
<pre class="highlight shell tab-shell"><code>curl -X DELETE -H <span class="s2">"X-Customer-Private-Token: alphanumeric_string"</span> <span class="se">\</span>
     -H <span class="s2">"X-Product-Name: custom-product-name"</span> <span class="se">\</span>
     <span class="s2">"https://connect.bstcm.no/api/v1/loyalty_clubs/:loyalty_club_slug/member_schema"</span>
</code></pre>
<blockquote>
<p>Successful removal is indicated by response code 200</p>
</blockquote>

<p><strong>DELETE</strong> <code class="prettyprint">api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<p>Removes member from loyalty club.</p>

<p>It is possible to trigger optout message by setting <code class="prettyprint">send_unsubscribe_message=true</code> query string parameter.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>DELETE</strong> <code class="prettyprint">api/v1/loyalty_clubs/:loyalty_club_slug/members/:msisdn</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>loyalty_club_slug</td>
<td>unique slugified name of the loyalty club. Example: <code class="prettyprint">boosters</code>.</td>
</tr>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined by E.164 (described above) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>send_unsubscribe_message</td>
<td>If true, optout message will be send to member. Example: <code class="prettyprint">true</code>.</td>
<td>Boolean</td>
</tr>
</tbody></table>

<h3 id="responses">Responses</h3>

<ul>
<li><strong>200</strong> - success with member&rsquo;s properties in response body</li>
<li><strong>404 Not found</strong> - member with <code class="prettyprint">msisdn</code> not found or it is invalid</li>
</ul>

<aside class="notice">
Authentication with <code>X-Member-Token</code> and <code>X-Customer-Private-Token</code>.
</aside>

          <h1 id="api-v3-reference-draft-work-in-progress">Api V3 reference (draft, work in progress)</h1>

<h2 id="general-info">General info</h2>

<p><strong>This is only draft!</strong></p>

<p>You can use Api V3 only when your customer is migrated to new backend service for data.</p>

<h3 id="product">Product</h3>

<blockquote>
<p>Example header: <code class="prettyprint">X-Product-Name: android-app</code></p>
</blockquote>

<p>Each system that is communicating with us should uniquely identify itself so it is possible to distinguish optin/update channels.
That will allow further targeting members by communication channel.</p>

<p>For that we use product name. It should be passed as <strong>required</strong> header <code class="prettyprint">X-Product-Name</code> that is intended to provide the necessary granularity.</p>

<p>If you miss your product name, please <a href="http://boostcom.no">let us know</a>.</p>

<h3 id="client-authorization">Client Authorization</h3>

<blockquote>
<p>Example header: <code class="prettyprint">X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM</code></p>
</blockquote>

<p>All of the endpoints <strong>require</strong> a client authorization header - <code class="prettyprint">X-Client-Authorization</code>.</p>

<p>It should be used only on backend and never exposed in frontend code.</p>

<p>Each token has are permits assigned to it. Depending what permits are assigned, access to some of the endpoints
may be restricted.</p>

<p>If you miss your authentication token, please <a href="http://boostcom.no">let us know</a>.</p>

<h3 id="x-user-agent">X-User-Agent</h3>

<blockquote>
<p>Example header: <code class="prettyprint">X-User-Agent: Infinity Mall Android App</code></p>
</blockquote>

<p><code class="prettyprint">X-User-Agent</code> is <strong>required</strong> to distinguish specific client for information and debugging purposes so we better know who uses the service.</p>

<p>It should be arbitrarily chosen to represent client specifics (e.g. &lsquo;Infinity Mall Android App v1.2&rsquo; or &lsquo;Infinity Mall Backend Service&rsquo;)</p>

<h3 id="oauth2"><a name="v3-oauth2"></a> OAuth2</h3>

<blockquote>
<p>Example header: <code class="prettyprint">Authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522</code></p>
</blockquote>

<p>Actions related to specific member (the one that is using your application) require to have member authenticated and we implement
OAuth2 flow for this.</p>

<p>Thos are specific actions that require OAuth2 authentication:</p>

<ul>
<li><a href="#v3-me-get">Me &gt; Get</a></li>
<li><a href="#v3-me-update">Me &gt; Update</a></li>
<li><a href="#v3-me-destroy">Me &gt; Destroy</a></li>
</ul>

<p>To authorize them, we <strong>require</strong> <code class="prettyprint">Authorization</code> header that should contain: <code class="prettyprint">Bearer :access_token</code>. </p>

<p>Look at <a href="#v3-token-create">OAuth Token &bull; Create</a> to see how to obtain the :access_token.</p>

<h3 id="common-url-parameter-loyalty_club_slug">Common URL Parameter - <code class="prettyprint">:loyalty_club_slug</code></h3>

<blockquote>
<p>Example slug: &lsquo;infinity-mall&rsquo;</p>
</blockquote>

<p>As all of the API endpoints work in the context of specific Loyalty Club, they&rsquo;re scoped within it&rsquo;s identifier - :loyalty_club_slug.</p>

<p>It&rsquo;s an unique slugified name of the Loyalty Club.</p>

<h3 id="common-http-error-codes">Common HTTP error codes</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">400</code></td>
<td>Some of required header is missing</td>
</tr>
<tr>
<td><code class="prettyprint">401</code></td>
<td><code class="prettyprint">X-Client-Authorization</code> is invalid (or doesn&rsquo;t match provided loyalty club or product)</td>
</tr>
<tr>
<td><code class="prettyprint">403</code></td>
<td>Not authorized to perform this action (provided <code class="prettyprint">X-Authorization-Token</code> doesn&rsquo;t have required permit)</td>
</tr>
<tr>
<td><code class="prettyprint">404</code></td>
<td>The requested resource doesn&rsquo;t exist</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid parameters are provided (e.g. incorrect properties on member creation)</td>
</tr>
<tr>
<td><code class="prettyprint">460</code></td>
<td>OAuth token required for the action is invalid (applies only to OAuth-related actions - see <a href="#v3-oauth2">OAuth2</a>)</td>
</tr>
</tbody></table>

<p>Also, most of handled errors have JSON response body like this:</p>

<p><code class="prettyprint">{&quot;error&quot;: &quot;Message describing what went wrong&quot;}</code></p>

<!--- ############################################################################################################# --->

<h2 id="member-json-model"><a name="v3-member-model"></a> Member JSON model</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ola"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nordmann"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-10-23"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"bikes_and_cars"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"sportwear"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"child_birth_years"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2010</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"sms_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hard_bounced"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"push_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disabled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-19T10:07:08.336+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-03T09:35:19.313+02:00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Standard member JSON model returned from many API endpoints.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member ID</td>
<td>integer</td>
</tr>
<tr>
<td>properties</td>
<td>Object with member&rsquo;s properties</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&lsquo;language&rsquo;]</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>consents</td>
<td>[incoming]</td>
<td>JSON Object</td>
</tr>
<tr>
<td>sms_status</td>
<td>Status of sms channel</td>
<td>string</td>
</tr>
<tr>
<td>email_status</td>
<td>Status of email channel</td>
<td>string</td>
</tr>
<tr>
<td>push_status</td>
<td>Status of push channel</td>
<td>string</td>
</tr>
<tr>
<td>created_at</td>
<td>Time when the user was firstly created</td>
<td>string</td>
</tr>
<tr>
<td>updated_at</td>
<td>Time when the user was last updated</td>
<td>string</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->

<h2 id="oauth-token-create"><a name="v3-token-create"></a> OAuth Token &bull; Create</h2>

<blockquote>
<p>Create token example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/oauth/token"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
      "grant_type": "password",
      "identifier_type": "id",
      "identifier": 42,
      "password": "123"
    }'</span>
</code></pre>
<blockquote>
<p>Refresh token example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/oauth/token"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
      "grant_type": "refresh_token",
      "refresh_token": "36c636e4290d28488a13691afce351397bec21b1246c2c7896a8262d9bfbc4c4"
    }'</span>
</code></pre>
<blockquote>
<p>When successful, both commands return JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"af9e5361cd7e083dfa4132df3ea7ab82fac21496991632a9994a8c2a9f33884f"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
  </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"36c636e4290d28488a13691afce351397bec21b1246c2c7896a8262d9bfbc4c4"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1506523094</span><span class="p">,</span><span class="w">
  </span><span class="s2">"resource_owner_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/oauth/token</code></p>

<p>Creates a new access token by one of two methods (grant types):</p>

<ul>
<li><code class="prettyprint">password</code> - token is issued by providing user credentials</li>
<li><code class="prettyprint">refresh_token</code> - token is issued by providing refresh token obtained from <code class="prettyprint">password</code> grant type </li>
</ul>

<h3 id="creating-token-password-grant">Creating token (<code class="prettyprint">password</code> grant)</h3>

<p>When creating new access token, <code class="prettyprint">&quot;grant_type&quot;: &quot;password&quot;</code> should be given along with member credentials (see example on the right).</p>

<p>In response, two tokens are returned:</p>

<ul>
<li><code class="prettyprint">access_token</code> that is valid for <strong>24 hours</strong> - may be used to authenticate member in member-related actions (see: <a href="#v3-oauth2">OAuth2</a>).</li>
<li><code class="prettyprint">refresh_token</code> which is valid for <strong>1 year</strong> - may be used to get a new access token (with <code class="prettyprint">refresh_token</code> grant)</li>
</ul>

<p>Also, <code class="prettyprint">resource_owner_id</code> is returned, is an ID of member that the token has been issued for. </p>

<h3 id="refreshing-token-refresh_token-grant">Refreshing token (<code class="prettyprint">refresh_token</code> grant)</h3>

<p>You can obtain a new token after (or before) it&rsquo;s expiration time, by using <code class="prettyprint">refresh_token</code> grant.</p>

<p>Param <code class="prettyprint">grant_type: &quot;refresh_token&quot;</code> must be provided along with <code class="prettyprint">refresh_token: &quot;:refresh_token&quot;</code>  (see example on the right).</p>

<p>It returns a token response, same as for <code class="prettyprint">password</code> grant, but with new tokens.</p>

<h3 id="post-parameters-json-object">POST Parameters (JSON object)</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
<th>For grant type</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>type of grant</td>
<td>enum: <code class="prettyprint">password</code>, <code class="prettyprint">refresh_token</code></td>
<td>-</td>
</tr>
<tr>
<td>identifier_type</td>
<td>identifier type that user should be retrieved by</td>
<td>enum: <code class="prettyprint">id</code>, <code class="prettyprint">email</code>, <code class="prettyprint">msisdn</code></td>
<td><code class="prettyprint">password</code></td>
</tr>
<tr>
<td>identifier</td>
<td>value of member identifier</td>
<td>mixed (e.g. <code class="prettyprint">134123123</code>, <code class="prettyprint">+47123456789</code> or <code class="prettyprint">alice@example.com</code>)</td>
<td><code class="prettyprint">password</code></td>
</tr>
<tr>
<td>password</td>
<td>member password</td>
<td>string</td>
<td><code class="prettyprint">password</code></td>
</tr>
<tr>
<td>refresh_token</td>
<td>refresh token</td>
<td>string</td>
<td><code class="prettyprint">access_token</code></td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>access_token</td>
<td>Token that member can be authenticated with</td>
<td>string</td>
</tr>
<tr>
<td>token_type</td>
<td>Always &ldquo;bearer&rdquo;</td>
<td>string</td>
</tr>
<tr>
<td>expires_in</td>
<td>Seconds for how long token will be valid</td>
<td>integer (seconds)</td>
</tr>
<tr>
<td>refresh_token</td>
<td>Token that may be used to issue a new :access_token</td>
<td>string</td>
</tr>
<tr>
<td>created_at</td>
<td>When the token has been created</td>
<td>integer (timestamp)</td>
</tr>
<tr>
<td>resource_owner_id</td>
<td>ID of member that the token has been for</td>
<td>integer</td>
</tr>
</tbody></table>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">421</code></td>
<td>Invalid member credentials provided for <code class="prettyprint">password</code> grant. Either member could not be found or password is wrong</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid refresh_token provided for <code class="prettyprint">refresh_token</code> grant (may be expired)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="oauth-token-revoke"><a name="v3-token-create"></a> OAuth Token &bull; Revoke</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/oauth/revoke"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
      "token": "36c636e4290d28488a13691afce351397bec21b1246c2c7896a8262d9bfbc4c4" 
    }'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/oauth/revoke</code></p>

<p>Revokes a token (access or refresh). </p>

<p>Always returns an empty response (even if given token is invalid).</p>

<h3 id="post-parameters-json">POST Parameters (JSON)</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>token</td>
<td>access or refresh token obtained from <a href="#v3-token-create">OAuth Token &bull; Create</a></td>
<td>string</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="oauth-token-info"><a name="v3-token-info"></a> OAuth Token &bull; Info</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/oauth/token/info"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522'</span>

</code></pre>
<blockquote>
<p>When successful, return JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"resource_owner_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">ID</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">member</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">has</span><span class="w"> </span><span class="err">been</span><span class="w"> </span><span class="err">issued</span><span class="w"> </span><span class="err">for</span><span class="w">
    </span><span class="s2">"scopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="s2">"expires_in_seconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">73614</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Seconds</span><span class="w"> </span><span class="err">until</span><span class="w"> </span><span class="err">expiration</span><span class="w">
    </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"uid"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1506516784</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/oauth/token/info</code></p>

<p>Returns info of given token (not refresh token) from <code class="prettyprint">Authorization</code> header.</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>resource_owner_id</td>
<td>ID of member that the token has been for</td>
<td>integer</td>
</tr>
<tr>
<td>scopes</td>
<td>Not implemented</td>
<td>Array<string></td>
</tr>
<tr>
<td>expires_in_seconds</td>
<td>Seconds for how long token will be valid</td>
<td>integer (seconds)</td>
</tr>
<tr>
<td>application</td>
<td>Not implemented</td>
<td>Object</td>
</tr>
<tr>
<td>created_at</td>
<td>When the token has been created</td>
<td>integer (timestamp)</td>
</tr>
</tbody></table>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">460</code></td>
<td>Token from <code class="prettyprint">Authorization</code> is invalid (or expired)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="loyalty-clubs-get-schema"><a name="v3-loyalty-clubs-schema"></a> Loyalty Clubs &bull; Get schema</h2>

<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/member_schema"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://json-schema.org/draft-04/schema#"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"identifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"email"</span><span class="p">],</span><span class="w">
  </span><span class="s2">"languages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"en"</span><span class="p">,</span><span class="w"> </span><span class="s2">"no"</span><span class="p">],</span><span class="w">
  </span><span class="s2">"default_language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"bikes_and_cars"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"sportwear"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/member_schema</code></p>

<p>Properties for members are defined as part of the loyalty club they belong to.</p>

<p>To describe member properties we use <a href="http://json-schema.org/documentation.html">JSON Schema</a> definition.
Properties of each member must conform to the defined schema.</p>

<p>We support <strong>JSON schema Draft V4</strong> with format extension for <code class="prettyprint">date</code> (YYYY-MM-DD).</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>identifiers</td>
<td>Fields that are set to identify member</td>
<td>Array<string></td>
</tr>
<tr>
<td>languages</td>
<td>Languages set up in loyalty club</td>
<td>Array<string></td>
</tr>
<tr>
<td>default_language</td>
<td>Default language used in loyalty club and also used for mappings to Api v2</td>
<td>string</td>
</tr>
<tr>
<td>version</td>
<td>Version of schema, currently the newest is <code class="prettyprint">v2</code></td>
<td>string</td>
</tr>
<tr>
<td>products</td>
<td>Properties scoping and ordering by product name, default one is <code class="prettyprint">default</code></td>
<td>object</td>
</tr>
<tr>
<td>required</td>
<td>Required properties for member</td>
<td>integer (timestamp)</td>
</tr>
<tr>
<td>properties</td>
<td>Properties describing member</td>
<td>object</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Schema:Get</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="members-check-if-exists"><a name="v3-members-check"></a> Members &bull; Check if exists</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -I <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/:id"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns hash consisting of just one property: :exists</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"exists"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id/check_existence</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn/check_existence</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/check_existence</code></p>

<p>It can be used to check whether member exists in loyalty club or not.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&rsquo;s msisdn</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>exists</td>
<td>boolean</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Check</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="members-get"><a name="v3-members-get"></a> Members &bull; Get</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/:id"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns member object as depicted <a href="#v3-member-model">here</a></p>
</blockquote>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email</code></p>

<p>Returns member by one of three identifier types: <code class="prettyprint">id</code>, <code class="prettyprint">member</code> or <code class="prettyprint">email</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&rsquo;s msisdn</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>See: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member with given identifier could not found</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Get</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="members-create"><a name="v3-members-create"></a> Members &bull; Create</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X POST <span class="se">\</span>
  https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "properties": {
        "email": "dev+6@test.com",
        "msisdn": "4740485124",
        "first_name": "The",
        "last_name": "Doge"
    },
    "send_welcome_message": false
}'</span>

</code></pre>
<blockquote>
<p>When successful, the above command returns created member object as depicted <a href="#v3-member-model">here</a></p>

<p>When payload is invalid, validation errors like this are returned:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">

            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"duplicated_email_in_community"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members</code></p>

<p>Create member with given properties.</p>

<p>Available properties and their validation rules are defined by Loyalty Club schema (see: <a href="#v3-loyalty-clubs-schema">here</a>).</p>

<p>Actual welcome messages sending depends on Loyalty Club and Product configuration.
For example, even if send_email_welcome_message:true param is provided, message may not be sent because either Product 
or Loyalty has disabled welcome messages or Loyalty Club has no e-mails configured at all.</p>

<p>There is also a possibility to have multiple SMS welcome messages sent. The one that matches Product or default one will be sent.</p>

<h3 id="post-parameters-json">POST Parameters (JSON)</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td><strong>yes</strong></td>
<td>none</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&lsquo;language&rsquo;]</td>
<td>no</td>
<td>&ldquo;default_language&rdquo; from schema</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>properties[&lsquo;msisdn&rsquo;]</td>
<td>yes*</td>
<td>none</td>
<td>Unique member&rsquo;s msisdn as defined <a href="#msisdn-member-identifier">here</a>) Example: <code class="prettyprint">4740485124</code>.</td>
<td>string</td>
</tr>
<tr>
<td>properties[&lsquo;email&rsquo;]</td>
<td>yes*</td>
<td>none</td>
<td>Member&rsquo;s email</td>
<td>string</td>
</tr>
<tr>
<td>password</td>
<td>no</td>
<td>none</td>
<td>Member&rsquo;s password. Not required, but user won&rsquo;t be able to log in without this</td>
<td>string</td>
</tr>
<tr>
<td>sms_enabled</td>
<td>no</td>
<td>true</td>
<td>Should SMS channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>email_enabled</td>
<td>no</td>
<td>true</td>
<td>Should email channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>push_enabled</td>
<td>no</td>
<td>true</td>
<td>Should push channel will be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_sms_welcome_message</td>
<td>no</td>
<td>true</td>
<td>Should SMS welcome message be sent to member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_email_welcome_message</td>
<td>no</td>
<td>true</td>
<td>Should email welcome be sent to member</td>
<td>Boolean</td>
</tr>
</tbody></table>

<p>&ast; At least one of those properties must be provided</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Created member properties - see: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Create</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="members-update"><a name="v3-members-update"></a> Members &bull; Update</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X PUT <span class="se">\</span>
  https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/:id <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "properties": {
        "last_name": "Doge"
    },
    "password": "new_password"
}'</span>

</code></pre>
<blockquote>
<p>When successful, the above command returns updated member object as depicted <a href="#v3-member-model">here</a></p>

<p>When payload is invalid, validation errors as depicted <a href="#v3-members-create">here</a></p>
</blockquote>

<p><strong>PUT</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id</code></p>

<p>Update member&rsquo;s properties with given ones.</p>

<p>It is intended for partial updates - not given properties are neither deleted nor overwritten.</p>

<p>If deleting attribute is intended, it&rsquo;s value should be sent as <code class="prettyprint">null</code>.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
</tbody></table>

<h3 id="put-parameters-json">PUT Parameters (JSON)</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
<tr>
<td>password</td>
<td>Member&rsquo;s password</td>
<td>string</td>
</tr>
<tr>
<td>sms_enabled</td>
<td>Should SMS channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>email_enabled</td>
<td>Should email channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>push_enabled</td>
<td>Should push channel will be enabled for member?</td>
<td>Boolean</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Member properties after update - see: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Update</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="members-destroy"><a name="v3-members-destroy"></a> Members &bull; Destroy</h2>

<p><strong>DELETE</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id</code></p>

<p>Permanently removes member.</p>

<p>It is possible to trigger optout message by setting <code class="prettyprint">send_unsubscribe_message=true</code> query string parameter.
Same as welcome messages, optout messages sending also depends on Loyalty Club and Product configuration.</p>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X DELETE <span class="se">\</span>
    <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/:id"</span> <span class="se">\</span>
    -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
    -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
    -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns destroyed member object as depicted <a href="#v3-member-model">here</a></p>
</blockquote>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>send_unsubscribe_message</td>
<td>no</td>
<td>true</td>
<td>Should optout message be sent to member?</td>
<td>Boolean</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Properties of member that has been destroyed - see: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Destroy</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="members-send-token"><a name="v3-members-send-token"></a> Members &bull; Send Token</h2>

<aside class="warn">
Draft  - Not implemented yet
</aside>

<p><strong>Member tokens</strong> are used to authenticate actions on particular members.
<strong>Member token</strong> could be issued even before registering enduser as a member in community.
In that case we create temporary token that is valid till end of day.
That <strong>member token</strong> could be used to authenticate <em>Create Member</em> action described below.</p>

<p>It sends member token to the user via SMS.</p>

<p>It can be used multiple times.</p>

<p>If msisdn is not valid, then <code class="prettyprint">400 Bad Request</code> is returned.</p>

<h3 id="http-request">HTTP Request</h3>

<p><strong>POST</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:msisdn/send_token</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>msisdn</td>
<td>unique member&rsquo;s msisdn as defined <a href="#msisdn-member-identifier">here</a>) Example: <code class="prettyprint">4740485124</code>.</td>
</tr>
</tbody></table>

<aside class="notice">
Authentication with <code>X-Client-Authorization</code> or <code>X-Customer-Private-Token</code>.
</aside>

<!--- ############################################################################################################# --->

<h2 id="me-get"><a name="v3-me-get"></a> Me &bull; Get</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/me"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522'</span>
</code></pre>
<blockquote>
<p>Responses as same as in <a href="#v3-members-get">Members &bull; Get</a></p>
</blockquote>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/me</code></p>

<p>Returns &ldquo;current&rdquo; member - the one that given Authorization token has been issued for.</p>

<p>As a member-related action, it requires member authorization. See <a href="#v3-oauth2">OAuth</a>.</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>See: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member associated with given Authorization token does not exist</td>
</tr>
<tr>
<td><code class="prettyprint">460</code></td>
<td>Member not authorized (Invalid or expired OAuth token)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:Get</code> permit.
</aside>

<!--- ############################################################################################################# --->

<h2 id="me-update"><a name="v3-me-update"></a> Me &bull; Update</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X PUT <span class="se">\</span>
  https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/me <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "properties": {
        "last_name": "Doge"
    },
    "password": "new_password"
}'</span>
</code></pre>
<blockquote>
<p>Responses are same as in <a href="#v3-members-update">Members &bull; Update</a></p>
</blockquote>

<p><strong>PUT</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/me</code></p>

<p>Updates &ldquo;&quot;current&rdquo; member - the one that given Authorization token has been issued for.</p>

<p>As a member-related action, it requires member authorization. See <a href="#v3-oauth2">OAuth</a>.</p>

<h3 id="parameters">Parameters</h3>

<p>It accepts same PUT and URL parameters as in <a href="#v3-members-update">Members &bull; Update</a>.</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Same as in <a href="#v3-members-update">Members &bull; Update</a>.</p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member associated with given Authorization token does not exist</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">Validation errors</a> JSON object.</td>
</tr>
<tr>
<td><code class="prettyprint">460</code></td>
<td>Member not authorized (Invalid or expired OAuth token)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:Update</code> permit.
</aside>

<!--- ############################################################################################################# --->

<h2 id="me-destroy"><a name="v3-me-destroy"></a> Me &bull; Destroy</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X DELETE <span class="se">\</span>
    <span class="s2">"https://connect.bstcm.no/api/v3/loyalty_clubs/infinity-mall/members/me"</span> <span class="se">\</span>
    -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
    -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
    -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
    -H <span class="s1">'Authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522'</span> <span class="se">\</span>
</code></pre>
<blockquote>
<p>Response as same as in <a href="#v3-members-destroy">Members &bull; Destroy</a></p>
</blockquote>

<p><strong>DELETE</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/me</code></p>

<p>Permanently removes &ldquo;current&rdquo; member - the one that given Authorization token has been issued for.</p>

<p>As a member-related action, it requires member authorization. See <a href="#v3-oauth2">OAuth</a>.</p>

<h3 id="parameters">Parameters</h3>

<p>It accepts same URL &amp; query parameters as in <a href="#v3-members-destroy">Members &bull; Destroy</a>.</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Same as in <a href="#v3-members-destroy">Members &bull; Destroy</a>.</p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member associated with given Authorization token does not exist</td>
</tr>
<tr>
<td><code class="prettyprint">460</code></td>
<td>Member not authorized (Invalid or expired OAuth token)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:Destroy</code> permit.
</aside>

<!--- ############################################################################################################# --->

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
